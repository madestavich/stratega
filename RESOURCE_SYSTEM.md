# üí∞ –°–∏—Å—Ç–µ–º–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤ –≥—Ä–∞–≤—Ü—è

## –û–≥–ª—è–¥

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≥—Ä–∞–≤—Ü—è (–≥—Ä–æ—à—ñ —Ç–∞ –ª—ñ–º—ñ—Ç —é–Ω—ñ—Ç—ñ–≤) –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö.

## üéØ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### Player Class (game/player.js)

–ö–ª–∞—Å Player —Ç–µ–ø–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏:

**–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:**

- `money` - –ø–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–æ—à–µ–π –≥—Ä–∞–≤—Ü—è
- `unitLimit` - –ø–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —é–Ω—ñ—Ç—ñ–≤
- `maxUnitLimit` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –ª—ñ–º—ñ—Ç —é–Ω—ñ—Ç—ñ–≤ –≤ –∫—ñ–º–Ω–∞—Ç—ñ
- `gameManager` - –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ gameManager –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ UI
- `roomId` - ID –∫—ñ–º–Ω–∞—Ç–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –ë–î

**–û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç–æ–¥–∏:**

```javascript
// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ –ë–î
await player.initializeResources();

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏
player.canAffordUnit(unitConfig); // —á–∏ –≤–∏—Å—Ç–∞—á–∞—î –≥—Ä–æ—à–µ–π?
player.hasUnitSlot(); // —á–∏ —î –≤—ñ–ª—å–Ω–∏–π —Å–ª–æ—Ç –¥–ª—è —é–Ω—ñ—Ç–∞?
player.canPurchaseUnit(unitConfig); // –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞

// –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø–æ–∫—É–ø–∫–∏ (–¥–ª—è UI)
const reason = player.getPurchaseBlockReason(unitConfig);

// –ö—É–ø—ñ–≤–ª—è —é–Ω—ñ—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–Ω—ñ–º–∞—î –≥—Ä–æ—à—ñ, –¥–æ–¥–∞—î –¥–æ –ª—ñ–º—ñ—Ç—É, –∑–±–µ—Ä—ñ–≥–∞—î –≤ –ë–î)
const success = await player.purchaseUnit(unitConfig);

// –î–æ–¥–∞—Ç–∏ –≥—Ä–æ—à—ñ
await player.addMoney(100);

// –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –ª—ñ–º—ñ—Ç (—Ç—ñ–ª—å–∫–∏ —Å—Ç–≤–æ—Ä—é–≤–∞—á –∫—ñ–º–Ω–∞—Ç–∏)
await player.setMaxUnitLimit(20);

// –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ –ë–î
await player.syncWithDatabase();
```

## üìù –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä–∞–≤—Ü—è (GameManager)

```javascript
this.player = new Player({
  nickname: "Player1",
  race: "all",
  team: playerTeam,
  coins: 100,
  gameManager: this,
  roomId: roomInfo?.room_id || this.objectManager.currentRoomId,
});

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Ä–µ—Å—É—Ä—Å–∏ –∑ –ë–î
await this.player.initializeResources();
```

### 2. –†–æ–∑–º—ñ—â–µ–Ω–Ω—è —é–Ω—ñ—Ç–∞ (InputManager)

```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –≥—Ä–∞–≤–µ—Ü—å –º–æ–∂–µ –∫—É–ø–∏—Ç–∏ —é–Ω—ñ—Ç–∞
if (!this.gameManager.player.canPurchaseUnit(unitConfig)) {
  const reason = this.gameManager.player.getPurchaseBlockReason(unitConfig);
  alert(reason); // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–∏—á–∏–Ω—É
  return;
}

// –ü–æ–∫—É–ø–∫–∞ —é–Ω—ñ—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–Ω—ñ–º–∞—î –≥—Ä–æ—à—ñ —ñ –¥–æ–¥–∞—î –¥–æ –ª—ñ–º—ñ—Ç—É)
const purchased = await this.gameManager.player.purchaseUnit(unitConfig);
if (!purchased) {
  console.error('Failed to purchase unit');
  return;
}

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —é–Ω—ñ—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—ñ
const newUnit = await this.gameManager.objectManager.createObject(...);
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI

UI –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —á–µ—Ä–µ–∑ `interfaceManager.updatePlayerResources()`.

## üé® UI –ï–ª–µ–º–µ–Ω—Ç–∏

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä–æ—à–µ–π

```html
<div id="gold-amount" class="resource-value">0</div>
```

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ª—ñ–º—ñ—Ç—É —é–Ω—ñ—Ç—ñ–≤

```html
<div id="unit-limit" class="resource-value">0/0</div>
```

**–ö–æ–ª—ñ—Ä–Ω–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è:**

- ‚ö™ –ë—ñ–ª–∏–π: –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω
- üü† –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ 80%+ –ª—ñ–º—ñ—Ç—É
- üî¥ –ß–µ—Ä–≤–æ–Ω–∏–π: –¥–æ—Å—è–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º—É–º

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

### –î–æ–¥–∞–Ω—ñ —Å—Ç–æ–≤–ø—Ü—ñ –≤ —Ç–∞–±–ª–∏—Ü—é `game_rooms`:

- `player1_money` - –≥—Ä–æ—à—ñ –ø–µ—Ä—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- `player2_money` - –≥—Ä–æ—à—ñ –¥—Ä—É–≥–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- `player1_unit_limit` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å —é–Ω—ñ—Ç—ñ–≤ –ø–µ—Ä—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- `player2_unit_limit` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å —é–Ω—ñ—Ç—ñ–≤ –¥—Ä—É–≥–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- `max_unit_limit` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –ª—ñ–º—ñ—Ç —é–Ω—ñ—Ç—ñ–≤ –≤ –∫—ñ–º–Ω–∞—Ç—ñ

### API endpoints (server/room.php):

- `get_player_money` - –æ—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä–æ—à—ñ
- `save_player_money` - –∑–±–µ—Ä–µ–≥—Ç–∏ –≥—Ä–æ—à—ñ
- `get_player_unit_limit` - –æ—Ç—Ä–∏–º–∞—Ç–∏ –ª—ñ–º—ñ—Ç —é–Ω—ñ—Ç—ñ–≤
- `save_player_unit_limit` - –∑–±–µ—Ä–µ–≥—Ç–∏ –ª—ñ–º—ñ—Ç —é–Ω—ñ—Ç—ñ–≤
- `get_max_unit_limit` - –æ—Ç—Ä–∏–º–∞—Ç–∏ –º–∞–∫—Å –ª—ñ–º—ñ—Ç
- `save_max_unit_limit` - –∑–±–µ—Ä–µ–≥—Ç–∏ –º–∞–∫—Å –ª—ñ–º—ñ—Ç (—Ç—ñ–ª—å–∫–∏ —Å—Ç–≤–æ—Ä—é–≤–∞—á)

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —é–Ω—ñ—Ç—ñ–≤

–ö–æ–∂–µ–Ω —é–Ω—ñ—Ç –º–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä `cost` –≤ —Ñ–∞–π–ª—ñ `races.json`:

```json
{
  "archer": {
    "cost": 100,
    "health": 40,
    ...
  }
}
```

## üîÑ –ü–æ—Ç—ñ–∫ —Ä–æ–±–æ—Ç–∏

1. **–ì—Ä–∞–≤–µ—Ü—å –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –∫—ñ–º–Ω–∞—Ç—É** ‚Üí Player.initializeResources() –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ –ë–î
2. **–ì—Ä–∞–≤–µ—Ü—å –≤–∏–±–∏—Ä–∞—î —é–Ω—ñ—Ç–∞** ‚Üí InputManager –∑–±–µ—Ä—ñ–≥–∞—î selectedUnitKey
3. **–ì—Ä–∞–≤–µ—Ü—å –∫–ª—ñ–∫–∞—î –Ω–∞ –∫–∞—Ä—Ç—É** ‚Üí InputManager.placeUnitAtCursor():
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –º–æ–∂–Ω–∞ –∫—É–ø–∏—Ç–∏ —é–Ω—ñ—Ç–∞ (canPurchaseUnit)
   - –í—ñ–¥–Ω—ñ–º–∞—î –≥—Ä–æ—à—ñ —Ç–∞ –¥–æ–¥–∞—î –¥–æ –ª—ñ–º—ñ—Ç—É (purchaseUnit)
   - –°—Ç–≤–æ—Ä—é—î —é–Ω—ñ—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—ñ
   - –û–Ω–æ–≤–ª—é—î UI
   - –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –∑ –ë–î

## üéÆ –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –î–æ–¥–∞—Ç–∏ –≥—Ä–æ—à—ñ –≥—Ä–∞–≤—Ü—é

```javascript
await gameManager.player.addMoney(500);
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –º–æ–∂–Ω–∞ –∫—É–ø–∏—Ç–∏ —é–Ω—ñ—Ç–∞

```javascript
const unitConfig = { cost: 100, ... };
if (player.canPurchaseUnit(unitConfig)) {
  console.log('–ú–æ–∂–Ω–∞ –∫—É–ø–∏—Ç–∏!');
} else {
  console.log(player.getPurchaseBlockReason(unitConfig));
}
```

### –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –ª—ñ–º—ñ—Ç

```javascript
// –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫—ñ–º–Ω–∞—Ç–∏
await player.setMaxUnitLimit(15);
```

### –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ –ë–î

```javascript
// –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –∑ —Å–µ—Ä–≤–µ—Ä–∞
await player.syncWithDatabase();
```

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

1. **Single Responsibility** - Player –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Å–≤–æ—ó —Ä–µ—Å—É—Ä—Å–∏
2. **–¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–∞—Ü—ñ—è** - –≤—Å—è –ª–æ–≥—ñ–∫–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –≤—Å—ñ –∑–º—ñ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ë–î
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI** - —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≤–∂–¥–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π
5. **Rollback –Ω–∞ –ø–æ–º–∏–ª–∫–∞—Ö** - —è–∫—â–æ –ë–î –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î, –∑–º—ñ–Ω–∏ –≤—ñ–¥–∫–æ—á—É—é—Ç—å—Å—è
6. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** - –≤—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –¥—ñ–π
7. **–ó—Ä—É—á–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** - getPurchaseBlockReason() –¥–ª—è UI feedback

## üêõ –ú–æ–∂–ª–∏–≤—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

1. **–†—ñ–∑–Ω—ñ –≤–∞–ª—é—Ç–∏** - –¥–æ–¥–∞—Ç–∏ gems, crystals —Ç–æ—â–æ
2. **–ú–∞–≥–∞–∑–∏–Ω** - –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç—ñ —Å–∞–º—ñ –º–µ—Ç–æ–¥–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ
3. **–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è** - –Ω–∞–≥–æ—Ä–æ–¥–∏ —á–µ—Ä–µ–∑ addMoney()
4. **–ü—Ä–æ–¥–∞–∂ —é–Ω—ñ—Ç—ñ–≤** - –º–µ—Ç–æ–¥ sellUnit() –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —á–∞—Å—Ç–∏–Ω–∏ –≥—Ä–æ—à–µ–π
5. **–°–∫–ª–∞–¥–Ω—ñ—à–∞ –µ–∫–æ–Ω–æ–º—ñ–∫–∞** - –∑–Ω–∏–∂–∫–∏, –±–æ–Ω—É—Å–∏, –º–Ω–æ–∂–Ω–∏–∫–∏
